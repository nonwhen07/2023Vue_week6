import{_ as U,o as c,c as u,a as t,t as d,F as C,e as M,f as V,v as E,g as y,d as m,h as b,L as A,b as r,w as P,r as f,i as T,n as L}from"./index-BF57zz8q.js";import{M as R,P as S}from"./modal-ENeBDjbu.js";import"./component-functions-DoEuF0vs.js";const N={props:["tempProduct","addToCart"],data(){return{userModal:null,editProduct:{},status:{addCartLoading:""}}},template:"",methods:{openModal(){this.userModal.show()},closeModal(){this.userModal.hide()}},watch:{tempProduct(){this.editProduct=this.tempProduct,this.qty=1}},mounted(){this.userModal=new R(this.$refs.userProductModal),this.editProduct=this.tempProduct}},j={id:"userProductModal",ref:"userProductModal",class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},D={class:"modal-dialog modal-xl",role:"document"},B={class:"modal-content border-0"},O={class:"modal-header bg-dark text-white"},z={class:"modal-title",id:"exampleModalLabel"},F=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),I={class:"modal-body"},H={class:"row"},G={class:"col-sm-6"},J=["src","alt","title"],K={class:"col-sm-6"},W={class:"badge bg-primary rounded-pill"},X={class:"h5"},Y={class:"h6"},Z={class:"h5"},$={class:"input-group"},tt=["value"],st=["disabled"],et={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function ot(a,o,l,g,e,i){return c(),u("div",j,[t("div",D,[t("div",B,[t("div",O,[t("h5",z,[t("span",null,d(l.tempProduct.title),1)]),F]),t("div",I,[t("div",H,[t("div",G,[(c(!0),u(C,null,M(l.tempProduct.imagesUrl,(h,v)=>(c(),u("img",{key:v,src:h,alt:l.tempProduct.title,class:"card-img-top primary-image",title:l.tempProduct.title+":"+l.tempProduct.description},null,8,J))),128))]),t("div",K,[t("span",W,d(l.tempProduct.title),1),t("p",null,"商品描述："+d(l.tempProduct.description),1),t("p",null,"商品內容："+d(l.tempProduct.content),1),t("div",X,d(l.tempProduct.origin_price)+" 元",1),t("del",Y,"原價 "+d(l.tempProduct.origin_price)+" 元",1),t("div",Z,"現在只要 "+d(l.tempProduct.price)+" 元",1),t("div",null,[t("div",$,[V(t("select",{class:"form-control",min:"1","onUpdate:modelValue":o[0]||(o[0]=h=>e.editProduct.qty=h)},[(c(),u(C,null,M(20,h=>t("option",{value:h,key:h},d(h),9,tt)),64))],512),[[E,e.editProduct.qty]]),t("button",{type:"button",class:"btn btn-primary",onClick:o[1]||(o[1]=h=>l.addToCart(l.tempProduct.id,l.tempProduct.qty)),disabled:l.tempProduct.id===e.status.addCartLoading},[l.tempProduct.id===e.status.addCartLoading?(c(),u("span",et)):y("",!0),m(" 加入購物車 ")],8,st)])])])])])])])],512)}const lt=U(N,[["render",ot]]);var at={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"jeff_hexschool",BASE_URL:"/2023Vue_week6",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:_,VITE_PATH:p}=at,it={props:["category"],data(){return{tempProduct:{},selectID:"",products:[],pages:{},carts:[],cartslength:0,status:{checkProduct:"",addCartLoading:"",cartQtyLoading:"",delCart:""},isLoading:!1,form:{user:{name:"",email:"",tel:"",address:""},message:""}}},inject:["emitter"],methods:{openModal(a){this.$refs.uModal.openModal(),this.status.checkProduct=a.id,this.tempProduct={...a},setTimeout(()=>{this.status.checkProduct=""},200)},getProducts(a=1){this.isLoading=!0;let o=`${_}/api/${p}/products?page=${a}`;this.category!==void 0&&(o=`${_}/api/${p}/products?page=${a}&category=${this.category}`),b.get(o).then(l=>{this.products=l.data.products,this.pages=l.data.pagination}),setTimeout(()=>{this.isLoading=!1},1e3)},getCarts(){this.isLoading=!0;const a=`${_}/api/${p}/cart`;b.get(a).then(o=>{this.carts=o.data.data,this.cartslength=o.data.data.carts.length}).catch(()=>{this.carts=[],this.cartslength=0}),setTimeout(()=>{this.isLoading=!1},1e3)},addToCart(a,o=1){this.status.addCartLoading=a;let l=`${_}/api/${p}/cart`,g="post",e={product_id:a,qty:o};b[g](l,{data:e}).then(i=>{this.status.addCartLoading="",this.$refs.uModal.closeModal(),i.data.success&&(this.getCarts(),this.emitter.emit("push-message",{style:"success",title:"加入購物車成功"}))}).catch(()=>{this.status.addCartLoading=""})},cartChangeQty(a,o=1){this.status.cartQtyLoading=a.id;let l=`${_}/api/${p}/cart/${a.id}`,g="put",e={product_id:a.id,qty:o};b[g](l,{data:e}).then(i=>{this.status.cartQtyLoading="",this.$refs.uModal.closeModal(),i.data.success&&(this.getCarts(),this.emitter.emit("push-message",{style:"success",title:"加入購物車成功"}))}).catch(i=>{this.emitter.emit("push-message",{style:"danger",title:"加入失敗",content:i.data.message.join("、")}),this.status.cartQtyLoading=""})},delCart(a){this.status.delCart=a;let o=`${_}/api/${p}/cart/${a}`;b["delete"](o).then(g=>{this.status.delCart="",g.data.success&&(this.getCarts(),this.emitter.emit("push-message",{style:"success",title:"刪除品項成功"}))})},delAllCart(){this.status.delCart="delAll";let a=`${_}/api/${p}/carts`;b["delete"](a).then(l=>{this.getCarts(),this.status.delCart="",l.data.success&&(this.getCarts(),this.emitter.emit("push-message",{style:"success",title:"已清空購物車"}))})},sendOrder(){this.isLoading=!0;let a=`${_}/api/${p}/order`;const o=this.form;b.post(a,{data:o}).then(l=>{this.$refs.form.resetForm(),this.isLoading=!1,l.data.success?(this.getCarts(),this.emitter.emit("push-message",{style:"success",title:"已送出訂單"})):this.emitter.emit("push-message",{style:"danger",title:"送出訂單失敗",content:l.data.message.join("、")})})},isPhone(a){return/^(09)[0-9]{8}$/.test(a)?!0:"電話為必填，須為有效的電話號碼"}},created(){},watch:{category(){this.getProducts()}},mounted(){this.isLoading=!0,this.getProducts(),this.getCarts(),setTimeout(()=>{this.isLoading=!1},1e3)},components:{Loading:A,Pagination:S,UserModal:lt}},dt=t("h2",null,"商品列表",-1),nt={class:"container"},rt={class:"mt-4"},ct={class:"list-group list-group-horizontal"},ut={class:"list-group-item btn btn-outline-primary p-0"},ht={class:"list-group-item btn btn-outline-primary p-0"},mt={class:"list-group-item btn btn-outline-primary p-0"},_t={class:"list-group-item btn btn-outline-primary p-0"},pt={class:"table align-middle"},gt=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"產品名稱"),t("th",null,"價格"),t("th")])],-1),bt={style:{"background-size":"cover","background-position":"center"}},ft=["src","alt","title"],yt={class:"h6"},vt={class:"h5"},Ct={class:"btn-group"},Pt=["disabled","onClick"],kt=t("i",{class:"fas fa-spinner fa-pulse"},null,-1),xt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Lt=["disabled","onClick"],Mt=t("i",{class:"fas fa-spinner fa-pulse"},null,-1),Vt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Tt={class:"text-end"},Ut=["disabled"],qt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},wt={class:"table align-middle"},Qt=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"170px"}},"數量/單位"),t("th",null,"單價")])],-1),Et=["onClick","disabled"],At={key:0,class:"fas fa-spinner fa-pulse"},Rt={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},St={class:"input-group input-group-sm"},Nt={class:"input-group mb-3"},jt=["onClick","disabled"],Dt=["onUpdate:modelValue","disabled"],Bt=["onClick","disabled"],Ot={class:"input-group-text",id:"basic-addon2"},zt={class:"text-end"},Ft=t("small",{class:"text-success"},"折扣價：",-1),It=t("td",{colspan:"3",class:"text-end"},"總計",-1),Ht={class:"text-end"},Gt=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Jt={class:"text-end text-success"},Kt={class:"my-5 row justify-content-center"},Wt={class:"mb-3"},Xt=t("label",{for:"email",class:"form-label"},"Email",-1),Yt={class:"mb-3"},Zt=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),$t={class:"mb-3"},ts=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),ss={class:"mb-3"},es=t("label",{for:"address",class:"form-label"},"收件人地址",-1),os={class:"mb-3"},ls=t("label",{for:"message",class:"form-label"},"留言",-1),as={class:"text-end"},is=["disabled"];function ds(a,o,l,g,e,i){const h=f("Loading"),v=f("RouterLink"),q=f("Pagination"),k=f("v-field"),x=f("error-message"),w=f("v-form"),Q=f("User-Modal");return c(),u(C,null,[r(h,{active:e.isLoading},null,8,["active"]),dt,t("div",nt,[t("div",rt,[t("ul",ct,[t("li",ut,[r(v,{class:"router-link-active active px-3 px-md-4 py-1",to:"/products/"},{default:P(()=>[m("全部")]),_:1})]),t("li",ht,[r(v,{class:"router-link-active active px-3 px-md-4 py-1",to:"/products/旅遊"},{default:P(()=>[m("旅遊")]),_:1})]),t("li",mt,[r(v,{class:"router-link-active active px-3 px-md-4 py-1",to:"/products/蔬果"},{default:P(()=>[m("蔬果")]),_:1})]),t("li",_t,[r(v,{class:"router-link-active active px-3 px-md-4 py-1",to:"/products/肉品"},{default:P(()=>[m("肉品")]),_:1})])]),t("table",pt,[gt,t("tbody",null,[(c(!0),u(C,null,M(e.products,s=>(c(),u("tr",{key:s.id},[t("td",null,[t("div",bt,[t("img",{class:"img-fluid",style:{height:"100px"},src:s.imageUrl,alt:s.title,title:s.title+":"+s.description},null,8,ft)])]),t("td",null,d(s.title),1),t("td",null,[t("del",yt,"原價 "+d(s.origin_price)+" 元",1),t("div",vt,"現在只要 "+d(s.price)+" 元",1)]),t("td",null,[t("div",Ct,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",disabled:s.id===e.status.checkProduct,onClick:n=>i.openModal(s)},[kt,s.id===e.status.checkProduct?(c(),u("span",xt)):y("",!0),m(" 查看更多 ")],8,Pt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:s.id===e.status.addCartLoading,onClick:n=>i.addToCart(s.id,1)},[Mt,s.id===e.status.addCartLoading?(c(),u("span",Vt)):y("",!0),m(" 加入購物車 ")],8,Lt)])])]))),128))])]),r(q,{pages:e.pages,"update-page":i.getProducts},null,8,["pages","update-page"]),e.cartslength>0?(c(),u(C,{key:0},[t("div",Tt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:o[0]||(o[0]=(...s)=>i.delAllCart&&i.delAllCart(...s)),disabled:e.status.delCart==="delAll"},[e.status.delCart==="delAll"?(c(),u("span",qt)):y("",!0),m(" 清空購物車 ")],8,Ut)]),t("table",wt,[Qt,t("tbody",null,[(c(!0),u(C,null,M(e.carts.carts,s=>(c(),u("tr",{key:s.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:n=>i.delCart(s.id),disabled:s.id===e.status.delCart},[s.id!==e.status.delCart?(c(),u("i",At,"x")):y("",!0),s.id===e.status.delCart?(c(),u("span",Rt)):y("",!0)],8,Et)]),t("td",null,d(s.product.title),1),t("td",null,[t("div",St,[t("div",Nt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:n=>(s.qty--,i.cartChangeQty(s,s.qty)),disabled:s.qty===1||s.id===e.status.cartQtyLoading}," - ",8,jt),V(t("input",{min:"1",type:"number",class:"form-control",style:{"text-align":"center"},"onUpdate:modelValue":n=>s.qty=n,disabled:s.id===e.status.cartQtyLoading,readonly:""},null,8,Dt),[[T,s.qty]]),t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:n=>(s.qty++,i.cartChangeQty(s,s.qty)),disabled:s.id===e.status.cartQtyLoading}," + ",8,Bt),t("span",Ot,d(s.product.unit),1)])])]),t("td",zt,[Ft,t("del",null,d(s.product.origin_price),1),m(" "+d(s.product.price),1)])]))),128))]),t("tfoot",null,[t("tr",null,[It,t("td",Ht,d(e.carts.total),1)]),t("tr",null,[Gt,t("td",Jt,d(e.carts.final_total),1)])])]),t("div",Kt,[r(w,{ref:"form",class:"col-md-6",onSubmit:i.sendOrder},{default:P(({errors:s})=>[t("div",Wt,[Xt,r(k,{id:"email",name:"email",type:"email",class:L(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:e.form.user.email,"onUpdate:modelValue":o[1]||(o[1]=n=>e.form.user.email=n)},null,8,["class","modelValue"]),r(x,{name:"email",class:"invalid-feedback"})]),t("div",Yt,[Zt,r(k,{id:"name",name:"姓名",type:"text",class:L(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:e.form.user.name,"onUpdate:modelValue":o[2]||(o[2]=n=>e.form.user.name=n)},null,8,["class","modelValue"]),r(x,{name:"姓名",class:"invalid-feedback"})]),t("div",$t,[ts,r(k,{id:"tel",name:"電話",type:"text",class:L(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:i.isPhone,modelValue:e.form.user.tel,"onUpdate:modelValue":o[3]||(o[3]=n=>e.form.user.tel=n)},null,8,["class","rules","modelValue"]),r(x,{name:"電話",class:"invalid-feedback"})]),t("div",ss,[es,r(k,{id:"address",name:"地址",type:"text",class:L(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:e.form.user.address,"onUpdate:modelValue":o[4]||(o[4]=n=>e.form.user.address=n)},null,8,["class","modelValue"]),r(x,{name:"地址",class:"invalid-feedback"})]),t("div",os,[ls,V(t("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":o[5]||(o[5]=n=>e.form.message=n)},null,512),[[T,e.form.message]])]),t("div",as,[t("button",{type:"submit",class:"btn btn-danger",disabled:e.form.user.id===e.status.cartQtyLoading}," 送出訂單 ",8,is)])]),_:1},8,["onSubmit"])])],64)):y("",!0)])]),r(Q,{"temp-product":e.tempProduct,"add-to-cart":i.addToCart,ref:"uModal"},null,8,["temp-product","add-to-cart"])],64)}const us=U(it,[["render",ds]]);export{us as default};
