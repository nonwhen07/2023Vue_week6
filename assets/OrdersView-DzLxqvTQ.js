import{_ as $,M as V,o,c as l,a as t,t as s,g as O,f as v,k,F as u,e as y,d as b,h as g,L as D,b as p,r as m}from"./index-DkNj6rE5.js";import{M as P,P as E}from"./modal-vLlyzpj8.js";const S={props:["tempOrder","updatePaid"],data(){return{ordModal:null,editOrder:{}}},methods:{openModal(){this.ordModal.show()},closeModal(){this.ordModal.hide()}},watch:{tempOrder(){this.editOrder=this.tempOrder}},mounted(){this.ordModal=new V(this.$refs.orderModal),this.editOrder=this.tempOrder}},T={id:"orderModal",ref:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},U={class:"modal-dialog modal-xl"},I={class:"modal-content border-0"},R={class:"modal-header bg-dark text-white"},B={id:"orderModalLabel",class:"modal-title"},N=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),A={class:"modal-body"},q={class:"row"},F={class:"col-md-4"},H=t("h3",null,"用戶資料",-1),j={class:"table"},z={key:0},G=t("th",{style:{width:"100px"}},"姓名",-1),J=t("th",null,"Email",-1),K=t("th",null,"電話",-1),Q=t("th",null,"地址",-1),W={class:"col-md-8"},X=t("h3",null,"訂單細節",-1),Y={class:"table"},Z=t("th",{style:{width:"100px"}},"訂單編號",-1),tt=t("th",null,"下單時間",-1),et=t("th",null,"付款狀態",-1),st={class:"form-check form-switch"},dt=["id"],ot=["for"],lt={key:0},nt={key:1},it=t("th",null,"總金額",-1),at=t("h3",null,"選購商品",-1),rt={class:"table"},ct={style:{"max-height":"100%","max-width":"100%",position:"static"}},ht=["src","alt","title"],_t={class:"text-end"},ut={class:"modal-footer"},pt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function mt(r,d,n,c,e,h){return o(),l("div",T,[t("div",U,[t("div",I,[t("div",R,[t("h5",B,[t("span",null,"訂單編號 "+s(e.editOrder.id),1)]),N]),t("div",A,[t("div",q,[t("div",F,[H,t("table",j,[e.editOrder.user?(o(),l("tbody",z,[t("tr",null,[G,t("td",null,s(e.editOrder.user.name),1)]),t("tr",null,[J,t("td",null,s(e.editOrder.user.email),1)]),t("tr",null,[K,t("td",null,s(e.editOrder.user.tel),1)]),t("tr",null,[Q,t("td",null,s(e.editOrder.user.address),1)])])):O("",!0)])]),t("div",W,[X,t("table",Y,[t("tbody",null,[t("tr",null,[Z,t("td",null,s(e.editOrder.id),1)]),t("tr",null,[tt,t("td",null,s(new Date(e.editOrder.create_at*1e3).toLocaleDateString()),1)]),t("tr",null,[et,t("td",null,[t("div",st,[v(t("input",{class:"form-check-input",type:"checkbox",name:"",id:`paidSwitch${e.editOrder.id}`,"onUpdate:modelValue":d[0]||(d[0]=i=>e.editOrder.is_paid=i)},null,8,dt),[[k,e.editOrder.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${e.editOrder.id}`},[e.editOrder.is_paid?(o(),l("span",lt,"已付款")):(o(),l("span",nt,"未付款"))],8,ot)])])]),t("tr",null,[it,t("td",null,s(e.editOrder.total),1)])])]),at,t("table",rt,[t("tbody",null,[(o(!0),l(u,null,y(e.editOrder.products,i=>(o(),l("tr",{key:i.id},[t("th",null,s(i.product.title),1),t("td",ct,[t("img",{src:i.product.imageUrl,alt:i.product.title,title:i.product.title+":"+i.product.description,class:"img-fluid",style:{height:"100px"}},null,8,ht)]),t("td",null,s(i.qty)+" "+s(i.product.unit),1),t("td",_t,s(i.final_total),1)]))),128))])])])])]),t("div",ut,[pt,t("button",{type:"button",class:"btn btn-primary",onClick:d[1]||(d[1]=i=>n.updatePaid(n.tempOrder))}," 確認送出 ")])])])],512)}const bt=$(S,[["render",mt]]),gt={props:["tempOrder","delOrder"],data(){return{delModal:null}},methods:{openModal(){this.delModal.show()},closeModal(){this.delModal.hide()}},mounted(){this.delModal=new P(this.$refs.delOrderModal)}},ft={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},Mt={class:"modal-dialog"},Ot={class:"modal-content border-0"},yt={class:"modal-header bg-danger text-white"},$t={id:"delOrderModalLabel",class:"modal-title"},vt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),kt={class:"modal-body"},xt={class:"text-danger"},wt={class:"text-danger"},Lt={class:"modal-footer"},Ct=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Vt(r,d,n,c,e,h){return o(),l("div",ft,[t("div",Mt,[t("div",Ot,[t("div",yt,[t("h5",$t,[t("span",null,"刪除訂單"+s(n.tempOrder.id),1)]),vt]),t("div",kt,[b(" 是否刪除 "),t("strong",xt,s(n.tempOrder.id),1),b(" (刪除後將無法恢復)。 "),t("strong",wt,s(n.tempOrder.message),1),b(" (刪除後將無法恢復)。 ")]),t("div",Lt,[Ct,t("button",{type:"button",class:"btn btn-danger",onClick:d[0]||(d[0]=i=>n.delOrder(n.tempOrder.id))}," 確認刪除 ")])])])],512)}const Dt=$(gt,[["render",Vt]]);var Pt={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"jeff_hexschool",BASE_URL:"/2023Vue_week6",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:M}=Pt,Et={data(){return{isLoading:!1,tempOrder:{},selectID:"",orders:[],pages:{}}},methods:{getOrders(r=1){this.isLoading=!0;const d=`${f}/api/${M}/admin/orders?page=${r}`;g.get(d).then(n=>{this.isLoading=!1,this.orders=n.data.orders,this.pages=n.data.pagination}).catch(()=>{this.isLoading=!1})},openModal(r="check",d){r=="dele"?this.$refs.dModal.openModal():this.$refs.oModal.openModal(),this.tempOrder={...d}},updatePaid(r){this.isLoading=!0;const d=`${f}/api/${M}/admin/order/${r.id}`,n="put",c={is_paid:r.is_paid};g[n](d,{data:c}).then(()=>{this.isLoading=!1,this.$refs.oModal.closeModal(),this.getOrders()}).catch(()=>{this.isLoading=!1,this.$refs.oModal.closeModal()})},delOrder(r){this.isLoading=!0;const d=`${f}/api/${M}/admin/order/${r}`;g["delete"](d).then(c=>{this.isLoading=!1,this.getOrders(),this.$refs.dModal.closeModal(),alert(c.data.message)}).catch(c=>{this.isLoading=!1,alert(c.data.message)})}},created(){this.getOrders()},mounted(){},components:{Pagination:E,OrdModal:bt,DelModal:Dt,Loading:D}},St={class:"container"},Tt={class:"table mt-4"},Ut=t("thead",null,[t("tr",null,[t("th",{width:"120"},"下單時間"),t("th",{width:"120"},"Email"),t("th",null,"訂單品項"),t("th",null,"應付金額"),t("th",{width:"100"},"付款狀態"),t("th",{width:"220"},"編輯")])],-1),It={key:0},Rt=["textContent"],Bt={class:"text-start"},Nt={class:"text-right"},At={class:"form-check form-switch"},qt=["id","onUpdate:modelValue","onChange"],Ft=["for"],Ht={key:0},jt={key:1},zt={class:"btn-group"},Gt=["onClick"],Jt=["onClick"];function Kt(r,d,n,c,e,h){const i=m("Loading"),x=m("Pagination"),w=m("Ord-Modal"),L=m("Del-Modal");return o(),l(u,null,[p(i,{active:e.isLoading},null,8,["active"]),t("div",St,[t("table",Tt,[Ut,t("tbody",null,[(o(!0),l(u,null,y(e.orders,a=>(o(),l(u,{key:a.id},[e.orders.length?(o(),l("tr",It,[t("td",null,s(new Date(a.create_at*1e3).toLocaleDateString()),1),t("td",null,[a.user?(o(),l("span",{key:0,textContent:s(a.user.email)},null,8,Rt)):O("",!0)]),t("td",Bt,[t("ul",null,[(o(!0),l(u,null,y(a.products,(_,C)=>(o(),l("li",{key:C}," 品項 : "+s(_.product.title)+" / "+s(_.qty)+s(_.product.unit),1))),128))])]),t("td",Nt,s(a.total),1),t("td",null,[t("div",At,[v(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${a.id}`,"onUpdate:modelValue":_=>a.is_paid=_,onChange:_=>h.updatePaid(a)},null,40,qt),[[k,a.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${a.id}`},[a.is_paid?(o(),l("span",Ht,"已付款")):(o(),l("span",jt,"未付款"))],8,Ft)])]),t("td",null,[t("div",zt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:_=>h.openModal("check",a)}," 查看細節 ",8,Gt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:_=>h.openModal("dele",a)}," 刪除訂單 ",8,Jt)])])])):O("",!0)],64))),128))])])]),p(x,{pages:e.pages,"update-page":h.getOrders},null,8,["pages","update-page"]),p(w,{"temp-order":e.tempOrder,"update-paid":h.updatePaid,ref:"oModal"},null,8,["temp-order","update-paid"]),p(L,{"temp-order":e.tempOrder,"del-order":h.delOrder,ref:"dModal"},null,8,["temp-order","del-order"])],64)}const Xt=$(Et,[["render",Kt]]);export{Xt as default};
