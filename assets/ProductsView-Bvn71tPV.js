import{_ as U,o as n,c,a as t,t as b,b as l,w as y,f as M,i as $,F as x,e as L,n as f,p as C,r as h,d as g,h as V,L as D}from"./index-BF57zz8q.js";import{M as I,P as E}from"./modal-ENeBDjbu.js";import"./component-functions-DoEuF0vs.js";const T={props:["tempProduct","updateProduct","addImage","delImage"],data(){return{prodModal:null,editProduct:{}}},methods:{openModal(){this.prodModal.show()},closeModal(){this.prodModal.hide()}},watch:{tempProduct(){this.editProduct=this.tempProduct}},mounted(){this.prodModal=new I(this.$refs.productModal),this.editProduct=this.tempProduct}},R={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},N={class:"modal-dialog modal-xl"},q={class:"modal-content border-0"},B={class:"modal-header bg-dark text-white"},S={id:"productModalLabel",class:"modal-title"},j={key:0},A={key:1},z=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),F={class:"modal-body"},H={class:"row"},O={class:"col-sm-4"},G={class:"mb-2"},J={class:"mb-3"},K=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),Q=["id","src","alt","title"],W=["onClick"],X={class:"col-sm-8"},Y={class:"mb-3"},Z=t("label",{for:"title",class:"form-label"},"標題",-1),tt={class:"row"},et={class:"mb-3 col-md-6"},ot=t("label",{for:"category",class:"form-label"},"分類",-1),st={class:"mb-3 col-md-6"},dt=t("label",{for:"unit",class:"form-label"},"單位",-1),lt={class:"row"},it={class:"mb-3 col-md-6"},at=t("label",{for:"origin_price",class:"form-label"},"原價",-1),nt={class:"mb-3 col-md-6"},ct=t("label",{for:"price",class:"form-label"},"售價",-1),rt=t("hr",null,null,-1),ut={class:"mb-3"},mt=t("label",{for:"description",class:"form-label"},"產品描述",-1),pt={class:"mb-3"},_t=t("label",{for:"content",class:"form-label"},"說明內容",-1),ht={class:"mb-3"},bt={class:"form-check"},gt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),ft=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{type:"submit",class:"btn btn-primary"}," 確認送出 ")],-1);function Pt(i,e,d,m,o,r){const p=h("v-field"),u=h("error-message"),k=h("v-form");return n(),c("div",R,[t("div",N,[t("div",q,[t("div",B,[t("h5",S,[d.tempProduct?(n(),c("span",j,"編輯"+b(d.tempProduct.title),1)):(n(),c("span",A,"新增產品"))]),z]),l(k,{ref:"form",onSubmit:e[10]||(e[10]=_=>d.updateProduct(d.tempProduct))},{default:y(({errors:_})=>[t("div",F,[t("div",H,[t("div",O,[t("div",G,[t("div",J,[K,M(t("input",{id:"addImageUrl",type:"text",class:"form-control",placeholder:"請輸入圖片連結",ref:"image","onUpdate:modelValue":e[0]||(e[0]=s=>o.editProduct.imageUrl=s)},null,512),[[$,o.editProduct.imageUrl]]),t("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[1]||(e[1]=s=>d.addImage())}," 新增圖片 ")]),(n(!0),c(x,null,L(o.editProduct.imagesUrl,(s,a)=>(n(),c(x,{key:a},[t("img",{id:`${o.editProduct.title+"_"+a}`,src:s,alt:o.editProduct.title,class:"card-img-top primary-image",title:o.editProduct.title+":"+o.editProduct.description},null,8,Q),t("button",{type:"button",class:"btn btn-outline-danger btn-sm d-block w-100",onClick:w=>d.delImage(a)}," 刪除圖片 ",8,W)],64))),128))])]),t("div",X,[t("div",Y,[Z,l(p,{id:"title",name:"標題",type:"text",class:f(["form-control",{"is-invalid":_.標題}]),placeholder:"請輸入標題",rules:"required",modelValue:o.editProduct.title,"onUpdate:modelValue":e[2]||(e[2]=s=>o.editProduct.title=s)},null,8,["class","modelValue"]),l(u,{name:"標題",class:"invalid-feedback"})]),t("div",tt,[t("div",et,[ot,l(p,{id:"category",name:"分類",type:"text",class:f(["form-control",{"is-invalid":_.分類}]),placeholder:"請輸入分類",rules:"required",modelValue:o.editProduct.category,"onUpdate:modelValue":e[3]||(e[3]=s=>o.editProduct.category=s)},null,8,["class","modelValue"]),l(u,{name:"分類",class:"invalid-feedback"})]),t("div",st,[dt,l(p,{id:"unit",name:"單位",type:"text",class:f(["form-control",{"is-invalid":_.單位}]),placeholder:"請輸入單位",rules:"required",modelValue:o.editProduct.unit,"onUpdate:modelValue":e[4]||(e[4]=s=>o.editProduct.unit=s)},null,8,["class","modelValue"]),l(u,{name:"單位",class:"invalid-feedback"})])]),t("div",lt,[t("div",it,[at,l(p,{id:"origin_price",name:"原價",type:"number",class:f(["form-control",{"is-invalid":_.原價}]),placeholder:"請輸入原價",rules:"required",modelValue:o.editProduct.origin_price,"onUpdate:modelValue":e[5]||(e[5]=s=>o.editProduct.origin_price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),l(u,{name:"原價",class:"invalid-feedback"})]),t("div",nt,[ct,l(p,{id:"price",name:"售價",type:"number",class:f(["form-control",{"is-invalid":_.售價}]),placeholder:"請輸入售價",rules:"required",modelValue:o.editProduct.price,"onUpdate:modelValue":e[6]||(e[6]=s=>o.editProduct.price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),l(u,{name:"售價",class:"invalid-feedback"})])]),rt,t("div",ut,[mt,M(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[7]||(e[7]=s=>o.editProduct.description=s)},`\r
                  `,512),[[$,o.editProduct.description]])]),t("div",pt,[_t,M(t("textarea",{id:"content",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[8]||(e[8]=s=>o.editProduct.content=s)},`\r
                  `,512),[[$,o.editProduct.content]])]),t("div",ht,[t("div",bt,[M(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[9]||(e[9]=s=>o.editProduct.is_enabled=s)},null,512),[[C,o.editProduct.is_enabled]]),gt])])])])]),ft]),_:1},512)])])],512)}const vt=U(T,[["render",Pt]]),yt={props:["tempProduct","delProduct"],data(){return{delModal:null}},methods:{openModal(){this.delModal.show()},closeModal(){this.delModal.hide()}},mounted(){this.delModal=new I(this.$refs.delProductModal)}},Mt={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},xt={class:"modal-dialog"},kt={class:"modal-content border-0"},$t=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Vt={class:"modal-body"},Ut={class:"text-danger"},wt={class:"modal-footer"},Lt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function It(i,e,d,m,o,r){return n(),c("div",Mt,[t("div",xt,[t("div",kt,[$t,t("div",Vt,[g(" 是否刪除 "),t("strong",Ut,b(d.tempProduct.title),1),g(" (刪除後將無法恢復)。 ")]),t("div",wt,[Lt,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=p=>d.delProduct(d.tempProduct.id))}," 確認刪除 ")])])])],512)}const Ct=U(yt,[["render",It]]);var Dt={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"jeff_hexschool",BASE_URL:"/2023Vue_week6",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:P,VITE_PATH:v}=Dt,Et={props:["category"],data(){return{isLoading:!1,isNew:!1,tempProduct:{},selectID:"",products:[],pages:{}}},inject:["emitter"],methods:{getProducts(i=1){this.isLoading=!0;let e=`${P}/api/${v}/admin/products?page=${i}`;this.category!==void 0&&(e=`${P}/api/${v}/products?page=${i}&category=${this.category}`),V.get(e).then(d=>{this.products=d.data.products,this.pages=d.data.pagination}),setTimeout(()=>{this.isLoading=!1},1e3)},openModal(i,e="edit",d){e=="dele"?this.$refs.dModal.openModal():this.$refs.pModal.openModal(),i?this.tempProduct={}:this.tempProduct={...d},this.isNew=i},updateProduct(i){let e=`${P}/api/${v}/admin/product`,d="post";this.isNew||(e=`${P}/api/${v}/admin/product/${i.id}`,d="put"),V[d](e,{data:i}).then(m=>{this.isNew=!1,this.$refs.pModal.closeModal(),m.data.success?(this.getProducts(),this.emitter.emit("push-message",{style:"success",title:"更新成功"})):this.emitter.emit("push-message",{style:"danger",title:"更新失敗",content:m.data.message.join("、")})})},delProduct(i){let e=`${P}/api/${v}/admin/product/${i}`;V["delete"](e).then(m=>{this.$refs.dModal.closeModal(),m.data.success?(this.getProducts(),this.emitter.emit("push-message",{style:"success",title:"已刪除產品"})):this.emitter.emit("push-message",{style:"danger",title:"刪除失敗",content:m.data.message.join("、")})})},addImage(){this.tempProduct.imagesUrl===void 0&&(this.tempProduct.imagesUrl=[]);const i=document.getElementById("addImageUrl").value;this.tempProduct.imagesUrl.push(i),this.tempProduct.imageUrl=this.tempProduct.imagesUrl[0]},delImage(i){this.tempProduct.imagesUrl.splice(i,1),this.tempProduct.imageUrl=this.tempProduct.imagesUrl[0]}},created(){this.getProducts()},watch:{category(){this.getProducts()}},mounted(){},components:{Pagination:E,ProdModal:vt,DelModal:Ct,Loading:D}},Tt=t("h2",null,"商品列表",-1),Rt={class:"container"},Nt={class:"text-end mt-4"},qt={class:"list-group list-group-horizontal"},Bt={class:"list-group-item btn btn-outline-primary p-0"},St={class:"list-group-item btn btn-outline-primary p-0"},jt={class:"list-group-item btn btn-outline-primary p-0"},At={class:"list-group-item btn btn-outline-primary p-0"},zt={class:"table mt-4"},Ft=t("thead",null,[t("tr",null,[t("th",{width:"120"}," 品項分類 "),t("th",{colspan:"2"},"產品名稱"),t("th",{width:"120"}," 原價 "),t("th",{width:"120"}," 售價 "),t("th",{width:"100"}," 是否啟用 "),t("th",{width:"120"}," 編輯 ")])],-1),Ht={style:{"max-height":"100%","max-width":"100%",position:"static"}},Ot=["src","alt","title"],Gt={class:"text-start"},Jt={class:"text-start"},Kt={key:0},Qt=t("p",{style:{color:"rgb(36, 212, 95)"}},"啟用",-1),Wt=[Qt],Xt={key:1},Yt=t("p",{style:{color:"red"}},"未啟用",-1),Zt=[Yt],te={class:"btn-group"},ee=["onClick"],oe=["onClick"];function se(i,e,d,m,o,r){const p=h("Loading"),u=h("RouterLink"),k=h("Pagination"),_=h("Prod-Modal"),s=h("Del-Modal");return n(),c(x,null,[l(p,{active:o.isLoading},null,8,["active"]),Tt,t("div",Rt,[t("div",Nt,[t("ul",qt,[t("li",Bt,[l(u,{class:"router-link-active active px-3 px-md-4 py-1",to:"/admin/products/"},{default:y(()=>[g("全部")]),_:1})]),t("li",St,[l(u,{class:"router-link-active active px-3 px-md-4 py-1",to:"/admin/products/旅遊"},{default:y(()=>[g("旅遊")]),_:1})]),t("li",jt,[l(u,{class:"router-link-active active px-3 px-md-4 py-1",to:"/admin/products/蔬果"},{default:y(()=>[g("蔬果")]),_:1})]),t("li",At,[l(u,{class:"router-link-active active px-3 px-md-4 py-1",to:"/admin/products/肉品"},{default:y(()=>[g("肉品")]),_:1})])]),t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=a=>r.openModal(!0))}," 建立新的產品 ")]),t("table",zt,[Ft,t("tbody",null,[(n(!0),c(x,null,L(o.products,a=>(n(),c("tr",{key:a.id},[t("td",null,b(a.category),1),t("td",Ht,[t("img",{src:a.imageUrl,alt:a.title,title:a.title+":"+a.description,class:"img-fluid",style:{height:"100px"}},null,8,Ot)]),t("td",null,b(a.title),1),t("td",Gt,b(a.origin_price),1),t("td",Jt,b(a.price),1),t("td",null,[a.is_enabled===1?(n(),c("div",Kt,Wt)):(n(),c("div",Xt,Zt))]),t("td",null,[t("div",te,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:w=>r.openModal(!1,"edit",a)}," 編輯 ",8,ee),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:w=>r.openModal(!1,"dele",a)}," 刪除 ",8,oe)])])]))),128))])])]),l(k,{pages:o.pages,"update-page":r.getProducts},null,8,["pages","update-page"]),l(_,{"temp-product":o.tempProduct,"update-product":r.updateProduct,"add-image":r.addImage,"del-image":r.delImage,ref:"pModal"},null,8,["temp-product","update-product","add-image","del-image"]),l(s,{"temp-product":o.tempProduct,"del-product":r.delProduct,ref:"dModal"},null,8,["temp-product","del-product"])],64)}const ae=U(Et,[["render",se]]);export{ae as default};
