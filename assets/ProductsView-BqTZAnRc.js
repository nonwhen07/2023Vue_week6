import{_ as U,o as r,c,a as t,t as d,F as y,e as L,f as M,v as w,g,d as v,h as _,L as Q,b as u,w as E,r as f,i as V,n as k}from"./index-DkNj6rE5.js";import{M as A,P as S}from"./modal-vLlyzpj8.js";const N={props:["tempProduct","addToCart"],data(){return{userModal:null,editProduct:{},status:{addCartLoading:""}}},template:"",methods:{openModal(){this.userModal.show()},closeModal(){this.userModal.hide()}},watch:{tempProduct(){this.editProduct=this.tempProduct,this.qty=1}},mounted(){this.userModal=new A(this.$refs.userProductModal),this.editProduct=this.tempProduct}},D={id:"userProductModal",ref:"userProductModal",class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-xl",role:"document"},B={class:"modal-content border-0"},O={class:"modal-header bg-dark text-white"},F={class:"modal-title",id:"exampleModalLabel"},I=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},z={class:"row"},H={class:"col-sm-6"},G=["src","alt","title"],J={class:"col-sm-6"},K={class:"badge bg-primary rounded-pill"},W={class:"h5"},X={class:"h6"},Y={class:"h5"},Z={class:"input-group"},$=["value"],tt=["disabled"],st={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function et(o,l,a,m,e,n){return r(),c("div",D,[t("div",R,[t("div",B,[t("div",O,[t("h5",F,[t("span",null,d(a.tempProduct.title),1)]),I]),t("div",j,[t("div",z,[t("div",H,[(r(!0),c(y,null,L(a.tempProduct.imagesUrl,(h,x)=>(r(),c("img",{key:x,src:h,alt:a.tempProduct.title,class:"card-img-top primary-image",title:a.tempProduct.title+":"+a.tempProduct.description},null,8,G))),128))]),t("div",J,[t("span",K,d(a.tempProduct.title),1),t("p",null,"商品描述："+d(a.tempProduct.description),1),t("p",null,"商品內容："+d(a.tempProduct.content),1),t("div",W,d(a.tempProduct.origin_price)+" 元",1),t("del",X,"原價 "+d(a.tempProduct.origin_price)+" 元",1),t("div",Y,"現在只要 "+d(a.tempProduct.price)+" 元",1),t("div",null,[t("div",Z,[M(t("select",{class:"form-control",min:"1","onUpdate:modelValue":l[0]||(l[0]=h=>e.editProduct.qty=h)},[(r(),c(y,null,L(20,h=>t("option",{value:h,key:h},d(h),9,$)),64))],512),[[w,e.editProduct.qty]]),t("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=h=>a.addToCart(a.tempProduct.id,a.tempProduct.qty)),disabled:a.tempProduct.id===e.status.addCartLoading},[a.tempProduct.id===e.status.addCartLoading?(r(),c("span",st)):g("",!0),v(" 加入購物車 ")],8,tt)])])])])])])])],512)}const lt=U(N,[["render",et]]);var at={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"jeff_hexschool",BASE_URL:"/2023Vue_week6",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:p,VITE_PATH:b}=at,ot={data(){return{tempProduct:{},selectID:"",products:[],pages:{},carts:[],cartslength:0,status:{checkProduct:"",addCartLoading:"",cartQtyLoading:"",delCart:""},isLoading:!1,form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{openModal(o){this.$refs.uModal.openModal(),this.status.checkProduct=o.id,this.tempProduct={...o},setTimeout(()=>{this.status.checkProduct=""},200)},getProducts(o=1){const l=`${p}/api/${b}/products?page=${o}`;_.get(l).then(a=>{this.products=a.data.products,this.pages=a.data.pagination}).catch(a=>{alert(a.data.message),this.isLoading=!1})},getCarts(){const o=`${p}/api/${b}/cart`;_.get(o).then(l=>{this.carts=l.data.data,this.cartslength=l.data.data.carts.length}).catch(l=>{alert(l.data.message),this.isLoading=!1,this.carts=[],this.cartslength=0})},addToCart(o,l=1){this.status.addCartLoading=o;let a=`${p}/api/${b}/cart`,m="post",e={product_id:o,qty:l};_[m](a,{data:e}).then(()=>{this.getCarts(),this.status.addCartLoading="",this.$refs.uModal.closeModal()}).catch(n=>{alert(n.data.message),this.status.addCartLoading=""})},cartChangeQty(o,l=1){this.status.cartQtyLoading=o.id;let a=`${p}/api/${b}/cart/${o.id}`,m="put",e={product_id:o.id,qty:l};_[m](a,{data:e}).then(()=>{this.getCarts(),this.status.cartQtyLoading="",this.$refs.uModal.closeModal()}).catch(n=>{alert(n.data.message),this.status.cartQtyLoading=""})},delCart(o){this.status.delCart=o;let l=`${p}/api/${b}/cart/${o}`;_["delete"](l).then(()=>{this.getCarts(),this.status.delCart=""}).catch(m=>{alert(m.data.message),this.status.delCart=""})},delAllCart(){this.status.delCart="delAll";let o=`${p}/api/${b}/carts`;_["delete"](o).then(()=>{this.getCarts(),this.status.delCart=""}).catch(a=>{alert(a.data.message),this.status.delCart=""})},sendOrder(){this.isLoading=!0;let o=`${p}/api/${b}/order`;const l=this.form;_.post(o,{data:l}).then(()=>{this.getCarts(),this.$refs.form.resetForm(),this.isLoading=!1}).catch(a=>{alert(a.data.message),this.isLoading=!1})},isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"電話為必填，須為有效的電話號碼"}},created(){},mounted(){this.isLoading=!0,this.getProducts(),this.getCarts(),setTimeout(()=>{this.isLoading=!1},1e3)},components:{Loading:Q,Pagination:S,UserModal:lt}},dt=t("h2",null,"商品列表",-1),nt={class:"container"},it={class:"mt-4"},rt={class:"table align-middle"},ct=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"產品名稱"),t("th",null,"價格"),t("th")])],-1),ut={style:{"background-size":"cover","background-position":"center"}},ht=["src","alt","title"],mt={class:"h6"},_t={class:"h5"},pt={class:"btn-group"},bt=["disabled","onClick"],gt=t("i",{class:"fas fa-spinner fa-pulse"},null,-1),ft={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},yt=["disabled","onClick"],vt=t("i",{class:"fas fa-spinner fa-pulse"},null,-1),Ct={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Pt={class:"text-end"},kt=["disabled"],Lt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},xt={class:"table align-middle"},Mt=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"170px"}},"數量/單位"),t("th",null,"單價")])],-1),Vt=["onClick","disabled"],Ut={key:0,class:"fas fa-spinner fa-pulse"},Tt={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},qt={class:"input-group input-group-sm"},wt={class:"input-group mb-3"},Qt=["onClick","disabled"],Et=["onUpdate:modelValue","disabled"],At=["onClick","disabled"],St={class:"input-group-text",id:"basic-addon2"},Nt={class:"text-end"},Dt=t("small",{class:"text-success"},"折扣價：",-1),Rt=t("td",{colspan:"3",class:"text-end"},"總計",-1),Bt={class:"text-end"},Ot=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Ft={class:"text-end text-success"},It={class:"my-5 row justify-content-center"},jt={class:"mb-3"},zt=t("label",{for:"email",class:"form-label"},"Email",-1),Ht={class:"mb-3"},Gt=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),Jt={class:"mb-3"},Kt=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),Wt={class:"mb-3"},Xt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),Yt={class:"mb-3"},Zt=t("label",{for:"message",class:"form-label"},"留言",-1),$t={class:"text-end"},ts=["disabled"];function ss(o,l,a,m,e,n){const h=f("Loading"),x=f("Pagination"),C=f("v-field"),P=f("error-message"),T=f("v-form"),q=f("User-Modal");return r(),c(y,null,[u(h,{active:e.isLoading},null,8,["active"]),dt,t("div",nt,[t("div",it,[t("table",rt,[ct,t("tbody",null,[(r(!0),c(y,null,L(e.products,s=>(r(),c("tr",{key:s.id},[t("td",null,[t("div",ut,[t("img",{src:s.imageUrl,alt:s.title,class:"img-fluid",style:{height:"100px"},title:s.title+":"+s.description},null,8,ht)])]),t("td",null,d(s.title),1),t("td",null,[t("del",mt,"原價 "+d(s.origin_price)+" 元",1),t("div",_t,"現在只要 "+d(s.price)+" 元",1)]),t("td",null,[t("div",pt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",disabled:s.id===e.status.checkProduct,onClick:i=>n.openModal(s)},[gt,s.id===e.status.checkProduct?(r(),c("span",ft)):g("",!0),v(" 查看更多 ")],8,bt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:s.id===e.status.addCartLoading,onClick:i=>n.addToCart(s.id,1)},[vt,s.id===e.status.addCartLoading?(r(),c("span",Ct)):g("",!0),v(" 加入購物車 ")],8,yt)])])]))),128))])]),u(x,{pages:e.pages,"update-page":n.getProducts},null,8,["pages","update-page"]),e.cartslength>0?(r(),c(y,{key:0},[t("div",Pt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:l[0]||(l[0]=(...s)=>n.delAllCart&&n.delAllCart(...s)),disabled:e.status.delCart==="delAll"},[e.status.delCart==="delAll"?(r(),c("span",Lt)):g("",!0),v(" 清空購物車 ")],8,kt)]),t("table",xt,[Mt,t("tbody",null,[(r(!0),c(y,null,L(e.carts.carts,s=>(r(),c("tr",{key:s.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>n.delCart(s.id),disabled:s.id===e.status.delCart},[s.id!==e.status.delCart?(r(),c("i",Ut,"x")):g("",!0),s.id===e.status.delCart?(r(),c("span",Tt)):g("",!0)],8,Vt)]),t("td",null,d(s.product.title),1),t("td",null,[t("div",qt,[t("div",wt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:i=>(s.qty--,n.cartChangeQty(s,s.qty)),disabled:s.qty===1||s.id===e.status.cartQtyLoading}," - ",8,Qt),M(t("input",{min:"1",type:"number",class:"form-control",style:{"text-align":"center"},"onUpdate:modelValue":i=>s.qty=i,disabled:s.id===e.status.cartQtyLoading,readonly:""},null,8,Et),[[V,s.qty]]),t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:i=>(s.qty++,n.cartChangeQty(s,s.qty)),disabled:s.id===e.status.cartQtyLoading}," + ",8,At),t("span",St,d(s.product.unit),1)])])]),t("td",Nt,[Dt,t("del",null,d(s.product.origin_price),1),v(" "+d(s.product.price),1)])]))),128))]),t("tfoot",null,[t("tr",null,[Rt,t("td",Bt,d(e.carts.total),1)]),t("tr",null,[Ot,t("td",Ft,d(e.carts.final_total),1)])])]),t("div",It,[u(T,{ref:"form",class:"col-md-6",onSubmit:n.sendOrder},{default:E(({errors:s})=>[t("div",jt,[zt,u(C,{id:"email",name:"email",type:"email",class:k(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:e.form.user.email,"onUpdate:modelValue":l[1]||(l[1]=i=>e.form.user.email=i)},null,8,["class","modelValue"]),u(P,{name:"email",class:"invalid-feedback"})]),t("div",Ht,[Gt,u(C,{id:"name",name:"姓名",type:"text",class:k(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:e.form.user.name,"onUpdate:modelValue":l[2]||(l[2]=i=>e.form.user.name=i)},null,8,["class","modelValue"]),u(P,{name:"姓名",class:"invalid-feedback"})]),t("div",Jt,[Kt,u(C,{id:"tel",name:"電話",type:"text",class:k(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:n.isPhone,modelValue:e.form.user.tel,"onUpdate:modelValue":l[3]||(l[3]=i=>e.form.user.tel=i)},null,8,["class","rules","modelValue"]),u(P,{name:"電話",class:"invalid-feedback"})]),t("div",Wt,[Xt,u(C,{id:"address",name:"地址",type:"text",class:k(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:e.form.user.address,"onUpdate:modelValue":l[4]||(l[4]=i=>e.form.user.address=i)},null,8,["class","modelValue"]),u(P,{name:"地址",class:"invalid-feedback"})]),t("div",Yt,[Zt,M(t("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":l[5]||(l[5]=i=>e.form.message=i)},null,512),[[V,e.form.message]])]),t("div",$t,[t("button",{type:"submit",class:"btn btn-danger",disabled:e.form.user.id===e.status.cartQtyLoading}," 送出訂單 ",8,ts)])]),_:1},8,["onSubmit"])])],64)):g("",!0)])]),u(q,{"temp-product":e.tempProduct,"add-to-cart":n.addToCart,ref:"uModal"},null,8,["temp-product","add-to-cart"])],64)}const as=U(ot,[["render",ss]]);export{as as default};
